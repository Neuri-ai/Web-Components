class Microphone extends HTMLElement {
  /**
		Consideraciones:

		para apagar/encender los estilos del microfono se debe toglear entre (ndshide y ndsactive)

	*/

  constructor() {
    super();
    this.shadowDOM = this.attachShadow({ mode: "open" });
    this.APIKEY = "";
    this.LANG = "en";
    this.SERVICE = "FULL";
    this.URL;
    this.TRANSLATE_TO = null;
    this.TEMPERATURE = 0.8;
    this.isRecording = false;
    this.socket = null;
    this.audioContext = null;
    this.mediaRecorder = null;
    this.audioChunks = [];

    // events
    this.$eventDetails; // should be object: {}
    // events
    this.onInit = new CustomEvent("onInit", {
      bubbles: true,
      composed: true,
      cancelable: true,
      detail: { message: "Initialized" },
    });
    this.onError = new CustomEvent("onError", {
      bubbles: true,
      composed: true,
      cancelable: true,
      detail: {},
    });
  }

  connectedCallback() {
    this.mapComponentAttributes();
    this.render();
    this.initComponent();
  }

  mapComponentAttributes() {
    const attributesMapping = [
      "apikey",
      "lang",
      "service",
      "temperature",
      "translate_to",
    ];

    attributesMapping.map((key) => {
      // if is missing an attribute, then show error
      if (!this.hasAttribute(key) && key !== "translate_to") {
        this.onError = new CustomEvent("onError", {
          bubbles: true,
          composed: true,
          cancelable: true,
          detail: {
            message: `Missing attribute: ${key}`,
          },
        });
        this.dispatchEvent(this.onError);

        // raise error
        throw new Error(`Missing attribute: ${key}`);
      } else {
        // set service uppercase and lang lowercase finaly set the attribute (except apikey)
        if (key === "service" || key === "lang") {
          this[key.toUpperCase()] = this.getAttribute(key).toUpperCase();
        } else {
          this[key.toUpperCase()] = this.getAttribute(key);
        }

        // if exists temperature check if can be parsed to float and if is between 0 and 1 and set the attribute
        if (key === "temperature") {
          if (
            parseFloat(this[key.toUpperCase()]) >= 0 &&
            parseFloat(this[key.toUpperCase()]) <= 1
          ) {
            this[key.toUpperCase()] = parseFloat(this[key.toUpperCase()]);
          } else {
            throw new Error(
              `Temperature must be between 0 and 1 and should be a float`
            );
          }
        }

        if (key === "translate_to") {
          this[key.toUpperCase()] = this.getAttribute(key);
        }

        // set the url
        this.URL = `wss://api.neuri.ai/api/v1/service/audio/realtime?lang=${this.LANG}&service=${this.SERVICE}&api_key=${this.APIKEY}&temperature=${this.TEMPERATURE}&translate_to=${this.TRANSLATE_TO}&samplerate=${this.SAMPLERATE}`;
      }
    });
  }

  render() {
    this.shadowDOM.innerHTML = `
				${this.templateCss()}
				${this.template()}
		`;
  }

  template() {
    return `<div class="permission-modal"><div id="poscontainer"><div id="neurimic" class="ndshide"><div id="ndl1" class="ndshide"></div><div id="ndl2" class="ndshide">${this.MicrophoneIcon()}</div><div id="ndl3" class="ndshide"></div><div id="ndl4" class="ndshide"></div><div></div></div>`;
  }

  templateCss() {
    return `<style>#ndl1.ndshide::after,#ndl3,#ndl4{content:'';border-radius:50%}#ndl1,#ndl3,#ndl4,#neurimic,#poscontainer{border-radius:50%}#ndl4,#neurimic.ndshide{scale:0.9}#ndl2,#ndl3,#ndl4{width:100%;height:100%;transition:1s cubic-bezier(.165, .84, .44, 1)}#poscontainer{position:absolute;width:90px;top:70px;left:calc(50% - (90px/2))}#neurimic{padding-top:100%;position:relative;cursor:pointer}#ndl3,#neurimic.ndsactive{scale:1.1}#ndl1,#ndl2,#ndl3,#ndl4{position:absolute;top:0;left:0;bottom:0;right:0}#ndl1{z-index:2;animation:4s linear infinite rotate;transition:2s cubic-bezier(.175, .885, .32, 1.275)}#ndl1.ndshide{background:radial-gradient(circle at 50% 0,#c2c1c1,transparent 100%),radial-gradient(circle at 0 50%,#5c5c5c,transparent 100%),radial-gradient(circle at 100% 50%,#5c5c5c,transparent 100%),radial-gradient(circle at 50% 100%,#5c5c5c,transparent 100%)}#ndl1.ndsactive{background:radial-gradient(circle at 3.15% 28.82%,#b063fb,transparent 85%),radial-gradient(circle at 98.83% 57.96%,#2f4aaf,transparent 85%),radial-gradient(circle at 46.18% 95.11%,#78feeb,transparent 85%)}#ndl1.ndshide::after{position:absolute;display:block;height:89%;width:89%;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#fff}#ndl2{scale:0.7;clip-path:url(#micropath);z-index:5}#ndl2.ndshide{background-color:#3b30d1ff}#ndl2.ndsactive{background-size:100% 400%!important;background-repeat:repeat-y;background:linear-gradient(0deg,#f4eaff 10%,#cf76fc 37%,#78fdfb 67%,#ebd9fd 91%);animation-name:bounce,scrollback;animation-duration:.5s,8s;animation-timing-function:ease,linear;animation-iteration-count:1,infinite}#ndl3{z-index:1}#ndl3.ndshide,#ndl4.ndshide{opacity:0;background:0 0}#ndl3.ndsactive,#ndl4.ndsactive{background:radial-gradient(circle at 3.15% 28.82%,#b063fb,transparent 100%),radial-gradient(circle at 98.83% 57.96%,#2f4aaf,transparent 100%),radial-gradient(circle at 46.18% 95.11%,#78feeb,transparent 100%);animation:4s linear infinite rotateinv;opacity:1}#ndl3.ndsactive{filter:blur(5px)}#ndl4{z-index:3}@keyframes rotate{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes rotateinv{from{transform:rotate(0)}to{transform:rotate(-360deg)}}@keyframes scrollback{100%{background-position-y:-400%}}@keyframes bounce{0%,100%,50%{scale:0.7}25%{scale:1}75%{scale:0.8}}</style>`;
  }

  MicrophoneIcon() {
    return `<svg width=".491" height="1" version="1.1" viewBox="0 0 .491 1"><defs><clipPath id='micropath' clipPathUnits="objectBoundingBox"><path fill="#3b30d1" d="m0.29523 0.26082c-0.001544-0.010236-0.002345-0.02073-0.002345-0.031423 0-0.11563 0.093727-0.20936 0.20936-0.20936 0.11563 0 0.20936 0.093727 0.20936 0.20936 0 0.009436-6.8622e-4 0.018728-0.001887 0.027849 0.006634-0.001001 0.012638-0.002001 0.018042-0.002974 0.001029-0.008778 0.001601-0.01767 0.001601-0.026706-2.813e-5 -0.12569-0.1019-0.22757-0.2276-0.22757-0.12569 0-0.22757 0.10188-0.22757 0.22757 0 0.010436 7.72e-4 0.020701 0.002144 0.030794 0.005862 8.2919e-4 0.012152 0.001658 0.0189 0.002459z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.74523 0.26783s-0.11031 0.011752-0.24524 0.011752-0.24524-0.011752-0.24524-0.011752v0.01484s0.00975 0.001029 0.026934 0.002488c0.025505 0.097787 0.11431 0.17001 0.22011 0.17001s0.19483-0.072368 0.22025-0.17033c0.01484-0.001287 0.023217-0.002173 0.023217-0.002173v-0.01484zm-0.24298 0.17093c-0.095757 0-0.17645-0.064305-0.20135-0.15208 0.002602 2.0014e-4 0.005318 4.0029e-4 0.00812 6.0044e-4 7.7201e-4 0.002631 0.001544 0.00529 0.00243 0.007863 0.001287 4.2889e-4 0.002688 6.2904e-4 0.004117 6.2904e-4 0.005175 0 0.009636-0.002945 0.011895-0.007234 0.003145 2.0015e-4 0.006376 4.003e-4 0.009664 6.2904e-4 -0.00426 0.002259-0.007177 0.006691-0.007177 0.011866 0 0.007434 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.004575-0.002287-0.008578-0.005747-0.011037 0.003117 1.7155e-4 0.00629 3.4311e-4 0.009521 5.1467e-4 0.002459 0.003174 0.00629 0.005261 0.010608 0.005261 0.00386 0 0.00732-0.00163 0.009779-0.004232 0.002688 1.1438e-4 0.005433 2.5734e-4 0.008206 3.7171e-4 -0.002202 0.002402-0.003603 0.005576-0.003603 0.009121 0 0.007434 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.003145-0.001115-0.006004-0.002945-0.00832 0.003059 1.1437e-4 0.006119 2.2874e-4 0.009235 3.1451e-4 0.002259 0.001687 0.005032 0.002745 0.008063 0.002745 0.002773 0 0.005375-8.5778e-4 0.00752-0.002287 0.003002 8.578e-5 0.006004 1.4296e-4 0.009035 2.2874e-4 -0.001372 0.002116-0.002173 0.004603-0.002173 0.00732 0 0.007434 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.002516-7.4341e-4 -0.004861-0.001944-0.006891 0.003403 5.719e-5 0.006805 8.578e-5 0.010236 1.1437e-4 0.00183 9.4356e-4 0.003889 0.001515 0.00609 0.001515 0.002202 0 0.004146-5.4326e-4 0.005919-0.00143h0.010265c-0.001115 0.001973-0.00183 0.004232-0.00183 0.006662 0 0.007434 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.002488-7.1482e-4 -0.004775-0.001887-0.006748 0.003345-2.859e-5 0.006662-5.718e-5 0.00995-1.1437e-4 0.001887 0.001001 0.004003 0.00163 0.00629 0.00163 0.00243 0 0.004689-6.8622e-4 0.006662-0.00183 0.003317-5.718e-5 0.006605-1.4296e-4 0.009864-2.0015e-4 -0.001344 0.002116-0.002173 0.004603-0.002173 0.007291 0 0.007434 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.002945-9.7215e-4 -0.005661-0.002573-0.007863 0.002916-8.578e-5 0.005804-1.7156e-4 0.008664-2.8593e-4 0.002287 0.001801 0.005147 0.002916 0.008263 0.002916 0.003488 0 0.006662-0.001372 0.009064-0.003545 0.003031-1.1437e-4 0.006004-2.5733e-4 0.008978-3.717e-4 -0.002259 0.002402-0.00366 0.005633-0.00366 0.009178 0 0.007434 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.004032-0.001801-0.007577-0.004575-0.010065 0.002831-1.4296e-4 0.005604-2.8592e-4 0.008349-4.2889e-4 0.002459 0.003174 0.00629 0.005232 0.010608 0.005232 0.004889 0 0.009121-0.002631 0.011494-0.006519 0.00386-2.2874e-4 0.007634-4.8607e-4 0.011294-7.1482e-4 -0.004918 0.002001-0.008406 0.006834-0.008406 0.012495 0 0.007434 0.006033 0.013496 0.013496 0.013496 0.003774 0 0.007177-0.001544 0.009636-0.004032 0.001372-0.003145 0.002659-0.006319 0.00386-0.00955-5.719e-5 -0.006262-0.004403-0.011494-0.010208-0.012952 0.004203-2.8592e-4 0.008178-5.7185e-4 0.012038-8.5778e-4 4.5748e-4 0.001172 0.001058 0.002316 0.001801 0.003288 3.717e-4 -0.001172 6.5763e-4 -0.002345 0.001001-0.003517 0.002716-2.0015e-4 0.005347-4.003e-4 0.007892-6.0045e-4 -0.02479 0.087951-0.10556 0.15243-0.20144 0.15243z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.49289 0.028849c-0.00629 2.8593e-4 -0.012495 8.5778e-4 -0.018642 0.0017156 0.002316 0.0018585 0.005232 0.0029451 0.008435 0.0029451 0.004089 0 0.007749-0.0018013 0.010207-0.0046607z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.54296 0.032738c-0.004318-8.8638e-4 -0.008664-0.0016298-0.013096-0.0022302 0.002316 0.0018871 0.00529 0.0030308 0.008521 0.0030308 0.001601 0 0.003145-2.8592e-4 0.004575-8.006e-4z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.42696 0.044032c-8.8637e-4 0-0.001773 8.578e-5 -0.002631 2.5734e-4 -0.001773 7.4341e-4 -0.003545 0.0015154-0.00529 0.002316-0.003374 0.002459-0.005576 0.0064334-0.005576 0.010922 0 0.0074341 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.0060331 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.46639 0.031823c-0.008549 0.001544-0.016898 0.0036027-0.025019 0.0062046v7.4341e-4c0 0.0074341 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.0060331 0.013496-0.013496 0-0.0025447-7.1482e-4 -0.0049179-0.001916-0.006948z" strokeWidth=".0028593" /><circle fill="#3b30d1" cx=".48269" cy=".057499" r=".013496" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.52026 0.029421c-0.005919-5.1467e-4 -0.011895-8.0059e-4 -0.017928-8.0059e-4h-6.8623e-4c-0.002802 0.002459-0.004603 0.0060902-0.004603 0.01015 0 0.0074341 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.0060331 0.013496-0.013496 0-0.0036313-0.00143-0.0069194-0.003775-0.0093498z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.044032c-0.007463 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.0060331 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.052267c0.005719 0 0.010608-0.0035741 0.012581-0.0086064-0.008263-0.0034025-0.016784-0.0062618-0.025562-0.0085206-3.1452e-4 0.0011723-4.8608e-4 0.0023732-4.8608e-4 0.0036599 0 0.0074341 0.006033 0.013496 0.013496 0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.59411 0.070995c0.007205 0 0.013067-0.0056328 0.013467-0.012724-0.006948-0.0042603-0.014153-0.0080917-0.021616-0.011494-0.00326 0.002459-0.005347 0.0063762-0.005347 0.010751 0 0.0074341 0.006033 0.013496 0.013496 0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.37126 0.081489c-0.002688 0-0.005204 8.006e-4 -0.00732 0.0021445-0.001287 0.0012009-0.002545 0.0024304-0.003803 0.0036885-0.001515 0.002173-0.002373 0.0048036-0.002373 0.0076628 0 0.0074341 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.06276c-0.007463 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.0060331 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.42696 0.081489c-0.007463 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.06276c-0.007463 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.0060331 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.081489c-0.007463 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.06276c-0.007463 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.0060331 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.081489c-0.007463 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.06276c-0.007463 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.0060331 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.59411 0.081489c-0.007434 0-0.013496 0.0060331-0.013496 0.013496 0 0.0074627 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.0074627-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.62196 0.089723c0.006634 0 0.012123-0.004775 0.013267-0.011065-0.005976-0.005261-0.012295-0.01015-0.018871-0.014697-0.004661 0.0021159-0.007892 0.0068337-0.007892 0.012266 0 0.0074341 0.006033 0.013496 0.013496 0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.64984 0.10845c0.003889 0 0.007377-0.00163 0.009836-0.00426-0.005633-0.0070052-0.011694-0.013639-0.018185-0.019815-0.003145 0.002459-0.005147 0.0062904-0.005147 0.010608 0 0.0074341 0.006033 0.013496 0.013496 0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.32837 0.12829c-0.003231 0.005518-0.006233 0.011237-0.00895 0.01707 0.005547-0.001658 0.009607-0.006834 0.009607-0.012924 0-0.001458-2.2874e-4 -0.002859-6.57e-4 -0.004146z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.34767 0.1009c-0.00549 0.006576-0.010579 0.013467-0.015211 0.020701 0.002459 0.003374 0.006433 0.005576 0.010922 0.005576 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.005947-0.00386-0.011008-0.009207-0.01281z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.37126 0.11895c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.10022c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.42696 0.11895c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.10022c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.11895c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.10022c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.11895c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.10022c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.59411 0.11895c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.62196 0.10022c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.64984 0.11895c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.66457 0.11054c-2.5734e-4 0.001001-3.7171e-4 0.002059-3.7171e-4 0.003174 0 0.006719 0.004918 0.012295 0.011351 0.013324-0.003403-0.00569-0.007062-0.01118-0.01098-0.016469z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.31553 0.15643h-8.5778e-4c-0.003031 0.00772-0.005633 0.015697-0.007691 0.023875 0.002345 0.001916 0.005318 0.003088 0.008578 0.003088 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.34341 0.1377c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.37126 0.15643c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.1377c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.42696 0.15643c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.1377c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.15643c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.1377c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.15643c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.1377c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.59411 0.15643c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.62196 0.1377c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.64984 0.15643c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.67769 0.16466c0.005518 0 0.010265-0.003317 0.012352-0.008092-0.002459-0.006233-0.005204-0.012324-0.008235-0.018242-0.001287-4.2889e-4 -0.002688-6.2904e-4 -0.004117-6.2904e-4 -0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.69307 0.16478c-6.5763e-4 0.001573-0.001001 0.003317-0.001001 0.005118 0 0.004603 0.002287 0.008664 0.005804 0.011094-0.001372-0.00549-0.002974-0.010894-0.004804-0.016212z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.31553 0.19389c-0.006433 0-0.011809 0.004518-0.013153 0.010551-1.1437e-4 8.8637e-4 -2.2874e-4 0.001744-3.1452e-4 0.002631v3.1452e-4c0 0.007434 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.34341 0.17516c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.37126 0.19389c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.17516c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.42696 0.19389c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.17516c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.19389c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.17516c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.19389c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.17516c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.59411 0.19389c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.62196 0.17516c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.64984 0.19389c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.67769 0.17516c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.70371 0.22074c-4.003e-4 -0.008835-0.001372-0.017499-0.002888-0.025991-0.005118 0.001916-0.008749 0.006862-0.008749 0.012638 0 0.006834 0.005061 0.012466 0.011637 0.013353z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.30118 0.22611c0-0.001001-1.1437e-4 -0.001973-3.1451e-4 -0.002888-8.578e-5 0.002087-1.1438e-4 0.004203-1.1438e-4 0.00629 2.8593e-4 -0.001087 4.2889e-4 -0.00223 4.2889e-4 -0.003403z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.31553 0.23134c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.34341 0.21261c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.38476 0.24484c0-0.007463-0.006033-0.013496-0.013496-0.013496-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.21261c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.44046 0.24484c0-0.007463-0.006033-0.013496-0.013496-0.013496-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.21261c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.23134c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.21261c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.23134c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.21261c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.60761 0.24484c0-0.007463-0.006033-0.013496-0.013496-0.013496-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.62196 0.21261c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.66331 0.24484c0-0.007463-0.006033-0.013496-0.013496-0.013496-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.67769 0.21261c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.70205 0.25788c0.001172-0.008635 0.00183-0.01747 0.001887-0.02642-0.006691 8.006e-4 -0.011866 0.006491-0.011866 0.013381 0 0.006233 0.004232 0.011494 0.009979 0.013038z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.34341 0.2501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.001515 2.5733e-4 0.002974 7.1482e-4 0.004346 0.007834 5.1467e-4 0.016155 0.001001 0.024933 0.001487 8.5778e-4 -0.001773 0.001315-0.003746 0.001315-0.005833 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.3658 0.26997c0.003946 2.0015e-4 0.007977 4.003e-4 0.012095 6.0045e-4 -0.001973-0.001115-0.004232-0.001744-0.006634-0.001744-0.001944 0-0.003774 4.003e-4 -0.005461 0.001144z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.2501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.002745 8.2919e-4 0.005318 0.00223 0.007434 0.007091 3.1452e-4 0.014382 6.0045e-4 0.021873 8.5778e-4 0.001801-0.002287 0.002859-0.005175 0.002859-0.00832 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.41807 0.27217c0.006033 2.0015e-4 0.012152 3.717e-4 0.018385 5.4326e-4 -0.00243-0.002402-0.005776-0.003889-0.009464-0.003889-0.003403 0-0.006519 0.001258-0.008892 0.003345z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.2501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.003631 0.00143 0.006919 0.003746 0.00935 0.00629 1.4296e-4 0.012667 2.5733e-4 0.0191 3.4311e-4 0.002545-0.002459 0.004117-0.00589 0.004117-0.009693 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.26883c-0.004032 0-0.007634 0.001773-0.010122 0.004575 0.006719 8.578e-5 0.013496 1.1437e-4 0.020358 1.4297e-4 -0.002488-0.002888-0.006147-0.004718-0.010236-0.004718z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.2501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.003946 0.001687 0.007491 0.004403 0.009979 0.006147 0 0.012238-2.859e-5 0.018271-8.578e-5 0.002659-0.002459 0.004317-0.005976 0.004317-0.009893 0-0.007463-0.006033-0.013496-0.013495-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.52829 0.27337c0.006719-8.578e-5 0.013381-1.7156e-4 0.019929-3.1452e-4 -0.002459-0.002602-0.005947-0.004232-0.009807-0.004232s-0.007634 0.001773-0.010093 0.004546z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.2501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.003603 0.00143 0.006891 0.003717 0.009293 0.006776-1.4296e-4 0.013467-3.4311e-4 0.020015-5.4326e-4 0.00203-0.002345 0.003231-0.005433 0.003231-0.008778 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.58533 0.27206c0.00569-2.0015e-4 0.011266-4.003e-4 0.016755-6.2904e-4 -0.00223-0.001658-0.005004-0.002631-0.007977-0.002631-0.003345 0-0.006405 0.001229-0.008778 0.003231z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.62196 0.2501c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.002773 8.2919e-4 0.005347 0.002287 0.007491 0.007949-3.4311e-4 0.01564-7.1481e-4 0.023074-0.001087 0.001029-0.001916 0.00163-0.004089 0.00163-0.006405 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.64618 0.26931c0.001944-1.1437e-4 0.00386-2.2875e-4 0.005776-3.4312e-4 -6.8623e-4 -1.1437e-4 -0.001401-1.7155e-4 -0.002116-1.7155e-4 -0.001258 0-0.002488 1.7155e-4 -0.003631 4.8607e-4z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.67769 0.2501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.00163 2.8593e-4 0.003174 8.006e-4 0.004632 0.009293-5.7185e-4 0.017956-0.001172 0.025848-0.001744 2.0015e-4 -9.1497e-4 3.1452e-4 -0.001887 3.1452e-4 -0.002859 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.31559 0.30628c0.003059 0.00752 0.006576 0.01484 0.010522 0.021902 0.00183-0.002316 0.002945-0.005232 0.002945-0.008406 0-0.007434-0.006004-0.013467-0.013439-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.37126 0.30628c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.42696 0.30628c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.30628c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.30628c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.59411 0.30628c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.64984 0.30628c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.34341 0.32501c-0.006348 0-0.011694 0.004403-0.013124 0.010322 0.003488 0.00569 0.007263 0.011208 0.011294 0.016527 6.0045e-4 8.578e-5 0.001201 1.1437e-4 0.00183 1.1437e-4 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.37126 0.34374c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.32501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.42696 0.34374c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.32501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.34374c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.32501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.34374c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.32501c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.59411 0.34374c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.62196 0.32501c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.64984 0.34374c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.006519 0.004632 0.01198 0.010808 0.01321 0.005461-0.005633 0.010579-0.01158 0.015354-0.017813-0.001887-0.005175-0.006862-0.008892-0.012695-0.008892z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.66419 0.33851c0 0.003059 0.001029 0.005861 0.002745 0.008149 0.004832-0.006834 0.009264-0.013982 0.013238-0.021387-8.0059e-4 -1.4296e-4 -0.00163-2.2874e-4 -0.002488-2.2874e-4 -0.007463 0-0.013496 0.006033-0.013496 0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.37126 0.38123c-7.72e-4 0-0.001544 5.719e-5 -0.002287 2.0015e-4 0.005032 0.004432 0.010293 0.008635 0.015755 0.012552-3.717e-4 -0.00712-0.006262-0.012752-0.013468-0.012752z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.3625c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.42696 0.38123c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.3625c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.38123c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.3625c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.38123c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.3625c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.59411 0.38123c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.001515 0 0.002945-2.5733e-4 0.004289-6.8622e-4 0.001458-8.006e-4 0.002916-0.001601 0.004346-0.00243 0.002974-0.002488 0.004861-0.006205 0.004861-0.010351 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.62196 0.3625c-0.007434 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.001944 0 0.003803-4.2889e-4 0.00549-0.001172 0.001887-0.001487 0.003717-0.003002 0.005547-0.004546 0.001544-0.002202 0.002459-0.004889 0.002459-0.007777 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.39911 0.39995c-0.001544 0-0.003059 2.5734e-4 -0.004432 7.4341e-4 0.00569 0.003603 0.01158 0.006919 0.017642 0.00995-0.001287-0.006119-0.006719-0.010694-0.01321-0.010693z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.45484 0.39995c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.00426 0.001973 0.008035 0.005032 0.010522 0.003545 0.001029 0.007148 0.001944 0.010751 0.002773 0.006348-0.001087 0.01118-0.006634 0.01118-0.013296 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.48269 0.41868c-0.006405 0-0.01178 0.004489-0.013153 0.010465 0.008692 0.00143 0.017584 0.002287 0.02662 0.002573-2.2875e-4 -0.007234-0.006176-0.013038-0.013467-0.013038z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.51054 0.39995c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.007463 0.006033 0.013496 0.013496 0.013496 0.007463 0 0.013496-0.006033 0.013496-0.013496 0-0.007463-0.006033-0.013496-0.013496-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.53841 0.41868c-0.006891 0-0.012581 0.005175-0.013381 0.011866 0.008664-9.7215e-4 0.017127-0.002488 0.025419-0.004518-0.00223-0.004375-0.006776-0.007348-0.012009-0.007348z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.56626 0.39995c-0.007463 0-0.013496 0.006033-0.013496 0.013496 0 0.004317 0.00203 0.008149 0.005175 0.010608 0.00732-0.002087 0.014496-0.004603 0.021444-0.007491 2.2874e-4 -0.001001 3.717e-4 -0.002059 3.717e-4 -0.003117 0-0.007463-0.006033-0.013496-0.013495-0.013496z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.63806 0.59784v-0.16043s-0.041088 0.041145-0.13739 0.041145c-0.0963 0-0.13479-0.039429-0.13479-0.039429v0.15752c0.017756 0.004832 0.05913 0.012667 0.14116 0.012667 0.067507 0 0.10831-0.006147 0.13098-0.011466z" strokeWidth=".0028593" /><path fill="#3b30d1" d="m0.65236 0.61543c-0.017384 0.005175-0.059759 0.01464-0.14002 0.015898-0.095071 0.001487-0.14273-0.010551-0.15457-0.014068-0.005404-0.001058-0.008406-0.001744-0.008406-0.001744v0.011666s0.006004 0.001573 0.016555 0.003746v0.20967c0 0.081003 0.05161 0.14785 0.11837 0.158 0 0 0.008921 0.001401 0.018128 0.001401 0.009207 0 0.017241-0.001401 0.017241-0.001401 0.066792-0.01015 0.11837-0.077 0.11837-0.158v-0.20976c0.010265-0.002144 0.016098-0.00366 0.016098-0.00366v-0.01218s-6.5763e-4 1.4296e-4 -0.00183 4.003e-4z" strokeWidth=".0028593" /></clipPath></defs></svg>`;
  }

  toggleMic() {
    this.$mic.classList.toggle("ndsactive");
    for (const child of this.$mic.children) {
      child.classList.toggle("ndsactive");
    }
  }

  cleanPreviousRecognition() {
    if (this.socket) {
      this.socket.close(); // Close the WebSocket connection
      this.socket = null;
    }
    if (this.mediaRecorder) {
      this.mediaRecorder.stop();
      this.mediaRecorder = null;
    }
    if (this.audioContext) {
      this.audioContext.close().then(() => {
        this.audioContext = null;
      });
    }
    this.isRecording = false;
  }

  async recognize() {
    this.socket = new WebSocket(this.URL);
    this.socket.onmessage = (event) => {
      try {
        this.onSpeech = new CustomEvent("onSpeech", {
          bubbles: true,
          composed: true,
          cancelable: true,
          detail: JSON.parse(event.data),
        });

        let data = JSON.parse(event.data);
        if (data.isFinal) {
          this.cleanPreviousRecognition();
          this.isRecording = false;
        }

        this.dispatchEvent(this.onSpeech);
      } catch (e) {}
    };

    this.socket.onclose = () => {
      this.toggleMic();
      this.cleanPreviousRecognition();
    };

    this.socket.onerror = () => {
      this.toggleMic();
      this.cleanPreviousRecognition();
    };

    this.socket.onopen = async () => {
      this.toggleMic();
      this.audioContext = new (window.AudioContext ||
        window.webkitAudioContext)({ sampleRate: 16000 });
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

      const source = this.audioContext.createMediaStreamSource(stream);
      const scriptProcessorNode = this.audioContext.createScriptProcessor(
        512,
        1,
        1
      );
      source.connect(scriptProcessorNode);
      scriptProcessorNode.connect(this.audioContext.destination);

      scriptProcessorNode.onaudioprocess = (event) => {
        const audioData = event.inputBuffer.getChannelData(0);
        this.audioChunks.push(new Float32Array(audioData));

        if (this.socket && this.socket.readyState === WebSocket.OPEN) {
          // reduce last audio chunk to buffer size (480)
          const lastChunk = this.audioChunks[this.audioChunks.length - 1];
          const lastChunkReduced = new Float32Array(480);
          lastChunkReduced.set(
            lastChunk.slice(lastChunk.length - 480, lastChunk.length),
            0
          );

          // convert  lastChunkReduced to 16-bit PCM wav format
          const buffer = new ArrayBuffer(lastChunkReduced.length * 2);
          const audio = new DataView(buffer);
          lastChunkReduced.forEach((value, index) => {
            audio.setInt16(index * 2, value * 0x7fff, true);
          });
          // convert the audio to base64 and send it to the server
          const base64String = btoa(
            String.fromCharCode(...new Uint8Array(buffer))
          );
          this.socket.send(
            JSON.stringify({
              audio_data: base64String,
            })
          );
        }
      };

      this.mediaRecorder = {
        stop: () => {
          scriptProcessorNode.disconnect();
          this.audioContext = null;
        },
      };
    };
  }

  async initComponent() {
    this.$root = this.shadowDOM.querySelector(".permission-modal");
    this.$mic = this.shadowDOM.getElementById("neurimic");

    this.$mic.onclick = async () => {
      if (this.isRecording) {
        this.cleanPreviousRecognition();
      } else {
        this.isRecording = true;
        await this.recognize();
      }
    };

    this.dispatchEvent(this.onInit);
  }

  disconnectedCallback() {
    this.cleanPreviousRecognition();
    this.remove();
  }
}

export default Microphone;
